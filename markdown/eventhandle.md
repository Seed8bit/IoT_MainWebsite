# 事件处理
<p>硬件平台的事件处理机制帮助用户选择在特定条件下触发硬件操作。</p>
<p>如用户可以选择硬件操作不会立即发生，而是等待某个特定时间或等待某个管脚电平的变化触发有硬件操作。</p>
<p>下图是对发送到硬件平台的数据包的简单说明：</p>
<br>
<img style="max-width: 350px; height: auto; " src="img/HttpRequest.png"/>
<br>
<p>下面对目前支持的事件处理进行详细的说明：</p>

* `now` 事件：
<p>该事件会即刻发送，发送包里的硬件操作会即可进行执行。格式如下：</p>

```
{
  "event":"now",
  "actions": [["硬件操作_1"], ["硬件操作_2"], ...]
}

//比如以下请求将管脚0的电压进行反转：
{
  "event":"now",
  "actions": [["gpio", 0, "output", 2]]
}

//比如如下请求读取管脚0和1的电压状态，然后再读取ADC0的采样：
{
  "event":"now",
  "actions": [["gpio", 0, "input", 0], ["gpio", 1, "input", 0], ["adc", 0, "5v"]]
}
```

* `schedule`事件
<p>该事件定义事件发生时间要求，当系统检测到满足时间要求时，硬件事件会被自动触发</p>

```
{
  "event":"schedule",
  "interval":"重复间隔"(必填)
  "start":"起始时间" (可选)
  "end":"结束时间" (可选)
  "actions": [["硬件操作_1"], ["硬件操作_2"], ...]
}

说明：
1. "重复间隔": 该参数为必填参数。必须有时间单位量，目前支持：'s'(秒), 'm'(分钟), 'h'(小时) 和 'd'(天)
2. "起始时间": 该参数为选填参数。必须满足日期时间格式: "YYYY/MM/DD HH:MM:SS" (比如: "2020/11/28 15:30:0")
3. "结束时间": 该参数为选填参数。必须满足日期时间格式: "YYYY/MM/DD HH:MM:SS" (比如: "2020/11/29 0:10:0")

比如如下请求将管脚0的电压进行反转，而且每5秒钟反转一次，从2020/1/1 的下午两点进行到下午四点。
{
  "event":"schedule",
  "interval":"5s",
  "start":"2020/1/1 14:00:00",
  "end":"2020/1/1 16:00:00",
  "actions": [["gpio", 0, "output",2]]
}
```

<blockquote>
<p>如果用户没有指定起始时间和结束时间，硬件操作会立即以间隔被不停地触发。</p>
<p>如果用户只指定了起始时间，硬件操作会在起始时间后以间隔被不停地触发。</p>
<p>如果用户只制定了结束时间，则硬件操作会立即以间隔被不停地触发直到结束时间。</p>
</blockquote>

* `pinstate`事件
<p>该事件定义当指定引脚的电压发生改变时，则硬件操作会被触发。</p>
<p>改变包括上升沿，下降沿或任何电压改变。格式如下：</p>

```
{
  "event": "pinstate",
  "pin": "管脚名称", (必填)
  "trigger": "触发条件", (必填)
  "actions": [["硬件操作_1"], ["硬件操作_2"], ...]
}

说明：
1. pin目前支持: 26 / 27 / 28 / 29
2. trigger支持：change/rising/falling，change即在管脚发生电压改变时触发，rising即在管脚上升沿触发，falling即在管脚下降沿触发。

比如如下请求在26上升沿时，反转管脚10的电压:
{
  "event": "pinstate",
  "pin": "26",
  "trigger": "rising",
  "actions": [["gpio",10,"output",2]]
}
```
